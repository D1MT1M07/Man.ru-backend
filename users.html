<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - Man.ru. –ù–∞–π–¥–∏—Ç–µ –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –≤–∞—Å –∞–≤—Ç–æ—Ä–æ–≤.">
    <title>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - Man.ru</title>
    <link rel="stylesheet" href="modern.css">
    <style>
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: white;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        }

        .user-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .user-card__avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            margin: 0 auto 15px;
            overflow: hidden;
        }

        .user-card__avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-card__name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .user-card__email {
            font-size: 12px;
            color: #999;
            margin-bottom: 15px;
        }

        .user-card__stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        .user-card__stat {
            font-size: 12px;
            color: #666;
        }

        .user-card__stat-number {
            font-size: 18px;
            font-weight: 700;
            color: #4a9eff;
        }

        .user-card__bio {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .user-card__button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .user-card__button--follow {
            background: #4a9eff;
            color: white;
        }

        .user-card__button--follow:hover {
            background: #2d7ed8;
        }

        .user-card__button--unfollow {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
        }

        .user-card__button--unfollow:hover {
            background: #e0e0e0;
        }

        .users-search {
            margin-bottom: 30px;
        }

        .users-search__input {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .users-empty {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__top">
            <div class="header__container">
                <div class="header__logo">
                    <h1><a href="index.html" style="text-decoration: none;">Man.ru</a></h1>
                    <div class="header__tagline">–°—Ç–∏–ª—å. –£—Å–ø–µ—Ö. –ì–∞—Ä–º–æ–Ω–∏—è</div>
                </div>
                <div class="header__search">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É..." class="header__search-input">
                    <button class="header__search-btn">üîç</button>
                </div>
                <div class="header__auth" id="authContainer">
                    <!-- Auth button will be inserted here -->
                </div>
            </div>
        </div>
        
        <nav class="header__nav">
            <div class="header__container">
                <ul class="nav__list">
                    <li><a href="health.html" class="nav__link">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</a></li>
                    <li><a href="fitness.html" class="nav__link">üí™ –§–∏—Ç–Ω–µ—Å</a></li>
                    <li><a href="career.html" class="nav__link">üíº –ö–∞—Ä—å–µ—Ä–∞</a></li>
                    <li><a href="tech.html" class="nav__link">‚ö° –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
                    <li><a href="style.html" class="nav__link">üëî –°—Ç–∏–ª—å</a></li>
                    <li><a href="relations.html" class="nav__link">üíë –û—Ç–Ω–æ—à–µ–Ω–∏—è</a></li>
                    <li><a href="forum.html" class="nav__link">üí¨ –§–æ—Ä—É–º</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Category Banner -->
    <section style="background: #2c3e50; padding: 40px 20px; color: white;">
        <div class="container">
            <h1 style="font-size: 32px; margin: 0 0 10px 0;">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
            <p style="font-size: 15px; margin: 0; opacity: 0.95;">–ù–∞–π–¥–∏—Ç–µ –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –≤–∞—Å –∞–≤—Ç–æ—Ä–æ–≤</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-container">
        <div class="container">
            <div class="layout">
                <!-- Left Column - Main Content -->
                <div class="main-content">
                    <!-- Search -->
                    <div class="users-search">
                        <input type="text" id="usersSearchInput" class="users-search__input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ email...">
                    </div>

                    <!-- Users Grid -->
                    <div class="users-grid" id="usersGrid">
                        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>

                    <!-- Empty State -->
                    <div id="usersEmpty" class="users-empty" style="display: none;">
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <aside class="sidebar">
                    <!-- Stats Block -->
                    <div class="sidebar-block">
                        <h4 class="sidebar-block__title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                        <div style="display: grid; gap: 12px;">
                            <div style="padding: 12px; background: #f5f5f5; border-radius: 4px;">
                                <div style="font-size: 12px; color: #999;">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div style="font-size: 20px; font-weight: 700; color: #4a9eff;" id="totalUsersCount">0</div>
                            </div>
                            <div style="padding: 12px; background: #f5f5f5; border-radius: 4px;">
                                <div style="font-size: 12px; color: #999;">–í–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏</div>
                                <div style="font-size: 20px; font-weight: 700; color: #4a9eff;" id="yourFollowingCount">0</div>
                            </div>
                            <div style="padding: 12px; background: #f5f5f5; border-radius: 4px;">
                                <div style="font-size: 12px; color: #999;">–í–∞—à–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                                <div style="font-size: 20px; font-weight: 700; color: #4a9eff;" id="yourSubscribersCount">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Categories Block -->
                    <div class="sidebar-block categories-block">
                        <h4 class="sidebar-block__title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h4>
                        <ul class="categories-list">
                            <li><a href="health.html">–ó–¥–æ—Ä–æ–≤—å–µ</a></li>
                            <li><a href="fitness.html">–§–∏—Ç–Ω–µ—Å</a></li>
                            <li><a href="career.html">–ö–∞—Ä—å–µ—Ä–∞</a></li>
                            <li><a href="tech.html">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
                            <li><a href="style.html">–°—Ç–∏–ª—å –∏ –º–æ–¥–∞</a></li>
                            <li><a href="relations.html">–û—Ç–Ω–æ—à–µ–Ω–∏—è</a></li>
                            <li><a href="forum.html">–§–æ—Ä—É–º</a></li>
                        </ul>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__container">
            <div class="footer__content">
                <div class="footer__section">
                    <h4>–û —Å–∞–π—Ç–µ</h4>
                    <ul>
                        <li><a href="about.html">–û Man.ru</a></li>
                        <li><a href="advertise.html">–†–µ–∫–ª–∞–º–∞</a></li>
                        <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                        <li><a href="career.html">–í–∞–∫–∞–Ω—Å–∏–∏</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                    <ul>
                        <li><a href="terms.html">–°–æ–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a></li>
                        <li><a href="privacy.html">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
                        <li><a href="terms.html">–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</a></li>
                        <li><a href="sitemap.html">–ö–∞—Ä—Ç–∞ —Å–∞–π—Ç–∞</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h4>
                    <ul>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">Telegram</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4>–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</h4>
                    <ul>
                        <li><a href="#">–í—Å–µ —Å—Ç–∞—Ç—å–∏</a></li>
                        <li><a href="#">–§–æ—Ä—É–º</a></li>
                        <li><a href="#">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                        <li><a href="#">–¢–æ–ø –∞–≤—Ç–æ—Ä–æ–≤</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer__bottom">
                <p>&copy; 2026 Man.ru. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>
    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal__overlay"></div>
        <div class="modal__content" style="max-width: 500px;">
            <div class="modal__header">
                <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <button id="closeAuthBtn" class="modal__close-btn">&times;</button>
            </div>
            
            <div class="auth-tabs">
                <button id="loginTab" class="auth-tab active">üîê –í—Ö–æ–¥</button>
                <button id="registerTab" class="auth-tab">‚úçÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="forum-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                </div>
                
                <button type="button" id="loginSubmit" class="btn btn--primary" style="width: 100%;">–í–æ–π—Ç–∏</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="forum-form" style="display: none;">
                <div class="form-group">
                    <label for="registerName">–ò–º—è</label>
                    <input type="text" id="registerName" placeholder="–í–∞—à–µ –∏–º—è" required>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPasswordConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                
                <button type="button" id="registerSubmit" class="btn btn--primary" style="width: 100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
        </div>
    </div>

    <!-- User Menu (for logged in users) -->
    <div id="userMenu" style="display: none; position: absolute; top: 60px; right: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 999;">
        <a href="profile.html" style="display: block; padding: 12px 20px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
        <button id="logoutBtn" style="width: 100%; padding: 12px 20px; background: none; border: none; color: #ef4444; cursor: pointer; text-align: left; font-weight: 600;">üö™ –í—ã—Ö–æ–¥</button>
    </div>
    <script src="auth-script.js"></script>
    <script src="search-script.js"></script>
    <script>
        class UsersPageManager {
            constructor() {
                this.usersKey = 'man_ru_users';
                this.currentUserKey = 'man_ru_current_user';
                this.init();
            }

            init() {
                this.loadUsers();
                this.setupSearch();
                this.updateStats();
                
                // Listen for subscribe events
                window.addEventListener('subscribersUpdated', () => {
                    this.loadUsers();
                    this.updateStats();
                });
            }

            loadUsers() {
                const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                const currentUser = JSON.parse(localStorage.getItem(this.currentUserKey));
                const grid = document.getElementById('usersGrid');
                const empty = document.getElementById('usersEmpty');

                if (users.length === 0) {
                    grid.style.display = 'none';
                    empty.style.display = 'block';
                    return;
                }

                // Filter out current user
                const otherUsers = users.filter(u => !currentUser || u.id !== currentUser.id);

                if (otherUsers.length === 0) {
                    grid.style.display = 'none';
                    empty.style.display = 'block';
                    return;
                }

                grid.style.display = 'grid';
                empty.style.display = 'none';

                grid.innerHTML = otherUsers.map(user => {
                    const avatar = user.avatar || 'üë§';
                    let avatarHTML = avatar;
                    if (avatar && avatar.startsWith('data:')) {
                        avatarHTML = `<img src="${avatar}">`;
                    } else {
                        avatarHTML = avatar;
                    }

                    const articlesCount = user.articles ? user.articles.length : 0;
                    const subscribersCount = user.followers ? user.followers.length : 0;
                    const isFollowing = currentUser && authManager ? authManager.isFollowing(user.id) : false;
                    const buttonText = isFollowing ? '‚úì –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                    const buttonClass = isFollowing ? 'user-card__button--unfollow' : 'user-card__button--follow';
                    const bio = user.bio || '–ù–µ—Ç –±–∏–æ–≥—Ä–∞—Ñ–∏–∏';

                    return `
                        <div class="user-card">
                            <div class="user-card__avatar">${avatarHTML}</div>
                            <div class="user-card__name">${user.name}</div>
                            <div class="user-card__email">${user.email}</div>
                            <div class="user-card__stats">
                                <div class="user-card__stat">
                                    <div class="user-card__stat-number">${articlesCount}</div>
                                    <div>–°—Ç–∞—Ç–µ–π</div>
                                </div>
                                <div class="user-card__stat">
                                    <div class="user-card__stat-number">${subscribersCount}</div>
                                    <div>–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                                </div>
                            </div>
                            <div class="user-card__bio">${bio}</div>
                            <div style="display: flex; gap: 8px; flex-direction: column;">
                                <a href="view-profile.html?id=${user.id}" style="display: block; text-align: center; padding: 10px; background: #f0f0f0; color: #333; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; font-weight: 600; transition: all 0.2s; cursor: pointer;">üëÅÔ∏è –ü—Ä–æ—Ñ–∏–ª—å</a>
                                ${currentUser ? 
                                    `<button class="user-card__button ${buttonClass}" onclick="usersPageManager.toggleSubscribe('${user.id}')">${buttonText}</button>` :
                                    `<p style="color: #999; font-size: 12px;">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏</p>`
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }

            setupSearch() {
                const searchInput = document.getElementById('usersSearchInput');
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                    const currentUser = JSON.parse(localStorage.getItem(this.currentUserKey));
                    
                    const filtered = users.filter(u => 
                        (!currentUser || u.id !== currentUser.id) && (
                            u.name.toLowerCase().includes(query) ||
                            u.email.toLowerCase().includes(query)
                        )
                    );

                    const grid = document.getElementById('usersGrid');
                    const empty = document.getElementById('usersEmpty');

                    if (filtered.length === 0) {
                        grid.style.display = 'none';
                        empty.style.display = 'block';
                        return;
                    }

                    grid.style.display = 'grid';
                    empty.style.display = 'none';

                    grid.innerHTML = filtered.map(user => {
                        const avatar = user.avatar || 'üë§';
                        let avatarHTML = avatar;
                        if (avatar && avatar.startsWith('data:')) {
                            avatarHTML = `<img src="${avatar}">`;
                        } else {
                            avatarHTML = avatar;
                        }

                        const articlesCount = user.articles ? user.articles.length : 0;
                        const subscribersCount = user.followers ? user.followers.length : 0;
                        const isFollowing = currentUser && authManager ? authManager.isFollowing(user.id) : false;
                        const buttonText = isFollowing ? '‚úì –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                        const buttonClass = isFollowing ? 'user-card__button--unfollow' : 'user-card__button--follow';
                        const bio = user.bio || '–ù–µ—Ç –±–∏–æ–≥—Ä–∞—Ñ–∏–∏';

                        return `
                            <div class="user-card">
                                <div class="user-card__avatar">${avatarHTML}</div>
                                <div class="user-card__name">${user.name}</div>
                                <div class="user-card__email">${user.email}</div>
                                <div class="user-card__stats">
                                    <div class="user-card__stat">
                                        <div class="user-card__stat-number">${articlesCount}</div>
                                        <div>–°—Ç–∞—Ç–µ–π</div>
                                    </div>
                                    <div class="user-card__stat">
                                        <div class="user-card__stat-number">${subscribersCount}</div>
                                        <div>–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                                    </div>
                                </div>
                                <div class="user-card__bio">${bio}</div>
                                <div style="display: flex; gap: 8px; flex-direction: column;">
                                    <a href="view-profile.html?id=${user.id}" style="display: block; text-align: center; padding: 10px; background: #f0f0f0; color: #333; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; font-weight: 600; transition: all 0.2s; cursor: pointer;">üëÅÔ∏è –ü—Ä–æ—Ñ–∏–ª—å</a>
                                    ${currentUser ? 
                                        `<button class="user-card__button ${buttonClass}" onclick="usersPageManager.toggleSubscribe('${user.id}')">${buttonText}</button>` :
                                        `<p style="color: #999; font-size: 12px;">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏</p>`
                                    }
                                </div>
                            </div>
                        `;
                    }).join('');
                });
            }

            toggleSubscribe(userId) {
                if (authManager) {
                    authManager.subscribeToUser(userId);
                    this.loadUsers();
                    this.updateStats();
                }
            }

            updateStats() {
                const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                const currentUser = JSON.parse(localStorage.getItem(this.currentUserKey));
                
                document.getElementById('totalUsersCount').textContent = users.length;

                if (currentUser && authManager) {
                    const followingCount = authManager.getFollowingCount(currentUser.id);
                    const subscribersCount = authManager.getSubscribersCount(currentUser.id);
                    document.getElementById('yourFollowingCount').textContent = followingCount;
                    document.getElementById('yourSubscribersCount').textContent = subscribersCount;
                } else {
                    document.getElementById('yourFollowingCount').textContent = '0';
                    document.getElementById('yourSubscribersCount').textContent = '0';
                }
            }
        }

        let usersPageManager;
        document.addEventListener('DOMContentLoaded', () => {
            usersPageManager = new UsersPageManager();
        });
    </script>

    <script src="api-client.js"></script>
    <script src="auth-script-api.js"></script>
    <script src="search-dropdown.js"></script>
</body>
</html>
