<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - Man.ru">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - Man.ru</title>
    <link rel="stylesheet" href="modern.css">
    <style>
        .user-profile-header {
            background: white;
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 30px;
            align-items: start;
        }

        .user-avatar-section {
            text-align: center;
        }

        .avatar-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 60px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .avatar-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info h1 {
            font-size: 24px;
            color: #222;
            margin-bottom: 8px;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f5f5f5;
            padding: 16px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-card__number {
            font-size: 20px;
            font-weight: 700;
            color: #4a9eff;
        }

        .stat-card__label {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #2d7ed8;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-secondary.subscribed {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        @media (max-width: 768px) {
            .user-profile-header {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .user-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__top">
            <div class="header__container">
                <div class="header__logo">
                    <h1><a href="index.html" style="text-decoration: none;">Man.ru</a></h1>
                    <div class="header__tagline">–°—Ç–∏–ª—å. –£—Å–ø–µ—Ö. –ì–∞—Ä–º–æ–Ω–∏—è</div>
                </div>
                <div class="header__search">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É..." class="header__search-input">
                    <button class="header__search-btn">üîç</button>
                </div>
                <div class="header__auth" id="authContainer">
                    <!-- Auth button will be inserted here -->
                </div>
            </div>
        </div>
        
        <nav class="header__nav">
            <div class="header__container">
                <ul class="nav__list">
                    <li><a href="health.html" class="nav__link">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</a></li>
                    <li><a href="fitness.html" class="nav__link">üí™ –§–∏—Ç–Ω–µ—Å</a></li>
                    <li><a href="career.html" class="nav__link">üíº –ö–∞—Ä—å–µ—Ä–∞</a></li>
                    <li><a href="tech.html" class="nav__link">‚ö° –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
                    <li><a href="style.html" class="nav__link">üëî –°—Ç–∏–ª—å</a></li>
                    <li><a href="relations.html" class="nav__link">üíë –û—Ç–Ω–æ—à–µ–Ω–∏—è</a></li>
                    <li><a href="forum.html" class="nav__link">üí¨ –§–æ—Ä—É–º</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <div class="container" style="max-width: 1200px;">
            <div id="userNotFound" style="text-align: center; padding: 60px 20px; display: none;">
                <h2 style="font-size: 24px; margin-bottom: 16px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
                <p style="color: #666; margin-bottom: 20px;">–í–æ–∑–º–æ–∂–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏–ª —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–µ–Ω ID</p>
                <a href="users.html" style="display: inline-block; background: #4a9eff; color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none; font-weight: 600;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</a>
            </div>

            <div id="userContent" style="display: none;">
                <!-- User Profile Header -->
                <div class="user-profile-header">
                    <div class="user-avatar-section">
                        <div class="avatar-circle" id="userAvatar">üë§</div>
                    </div>
                    <div class="user-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap;">
                            <h1 id="userName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                        </div>
                        <p id="userEmail" style="color: #666; font-size: 14px; margin-bottom: 16px;">email@example.com</p>
                        <p id="userBio" style="color: #777; font-size: 14px; margin-bottom: 16px; font-style: italic;"></p>
                        <div class="user-stats">
                            <div class="stat-card">
                                <div class="stat-card__number" id="userArticlesCount">0</div>
                                <div class="stat-card__label">–°—Ç–∞—Ç–µ–π –Ω–∞–ø–∏—Å–∞–Ω–æ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__number" id="userPostsCount">0</div>
                                <div class="stat-card__label">–ü–æ—Å—Ç–æ–≤ –Ω–∞ —Ñ–æ—Ä—É–º–µ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__number" id="userSubscribersCount">0</div>
                                <div class="stat-card__label">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__number" id="userFollowingCount">0</div>
                                <div class="stat-card__label">–ü–æ–¥–ø–∏—Å–æ–∫</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button id="subscribeBtn" class="btn-primary" style="display: none;">
                                üìå –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Articles Section -->
                <div class="profile-section">
                    <h3 class="profile-section__title">üìù –°—Ç–∞—Ç—å–∏ —ç—Ç–æ–≥–æ –∞–≤—Ç–æ—Ä–∞</h3>
                    <div id="userArticles" class="section-content"></div>
                    <div id="noArticles" class="empty-state" style="display: none;">
                        <div class="empty-state__icon">üì≠</div>
                        <p>–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª —Å—Ç–∞—Ç–µ–π</p>
                    </div>
                </div>

                <!-- Posts Section -->
                <div class="profile-section">
                    <h3 class="profile-section__title">üí¨ –ü–æ—Å—Ç—ã –Ω–∞ —Ñ–æ—Ä—É–º–µ</h3>
                    <div id="userPosts" class="section-content"></div>
                    <div id="noPosts" class="empty-state" style="display: none;">
                        <div class="empty-state__icon">üí≠</div>
                        <p>–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–ª –ø–æ—Å—Ç—ã –Ω–∞ —Ñ–æ—Ä—É–º–µ</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__container">
            <div class="footer__content">
                <div class="footer__section">
                    <h4>–û —Å–∞–π—Ç–µ</h4>
                    <ul>
                        <li><a href="about.html">–û Man.ru</a></li>
                        <li><a href="advertise.html">–†–µ–∫–ª–∞–º–∞</a></li>
                        <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                    <ul>
                        <li><a href="terms.html">–°–æ–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a></li>
                        <li><a href="privacy.html">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer__bottom">
                <p>&copy; 2026 Man.ru. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script src="api-client.js"></script>
    <script src="auth-script-api.js"></script>
    <script src="search-dropdown.js"></script>
    <script>
        class UserProfileViewer {
            constructor() {
                this.usersKey = 'man_ru_users';
                this.articlesKey = 'man_ru_articles';
                this.forumPostsKey = 'man_ru_forum_posts';
                this.currentUserKey = 'man_ru_current_user';
                this.init();
            }

            init() {
                // Get user ID from URL parameter
                const params = new URLSearchParams(window.location.search);
                const userId = params.get('id');

                if (userId) {
                    this.loadUserProfile(userId);
                } else {
                    this.showNotFound();
                }
            }

            loadUserProfile(userId) {
                const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                const user = users.find(u => u.id === userId);

                if (!user) {
                    this.showNotFound();
                    return;
                }

                this.displayUserProfile(user);
                this.loadUserContent(user);
                this.setupSubscribeButton(user);
            }

            displayUserProfile(user) {
                const avatar = user.avatar || 'üë§';
                let avatarHTML = avatar;
                if (avatar && avatar.startsWith('data:')) {
                    avatarHTML = `<img src="${avatar}">`;
                }

                const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                const subscribersCount = user.followers ? user.followers.length : 0;
                const followingCount = user.following ? user.following.length : 0;

                document.getElementById('userContent').style.display = 'block';
                document.getElementById('userNotFound').style.display = 'none';

                document.getElementById('userAvatar').innerHTML = avatarHTML;
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userBio').textContent = user.bio || '–ù–µ—Ç –±–∏–æ–≥—Ä–∞—Ñ–∏–∏';

                const articles = JSON.parse(localStorage.getItem(this.articlesKey)) || [];
                const posts = JSON.parse(localStorage.getItem(this.forumPostsKey)) || [];

                const userArticles = articles.filter(a => a.authorEmail === user.email);
                const userPosts = posts.filter(p => p.authorEmail === user.email);

                document.getElementById('userArticlesCount').textContent = userArticles.length;
                document.getElementById('userPostsCount').textContent = userPosts.length;
                document.getElementById('userSubscribersCount').textContent = subscribersCount;
                document.getElementById('userFollowingCount').textContent = followingCount;
            }

            loadUserContent(user) {
                const articles = JSON.parse(localStorage.getItem(this.articlesKey)) || [];
                const posts = JSON.parse(localStorage.getItem(this.forumPostsKey)) || [];
                const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];

                const userArticles = articles.filter(a => a.authorEmail === user.email);
                const userPosts = posts.filter(p => p.authorEmail === user.email);

                this.displayArticles(userArticles, users);
                this.displayPosts(userPosts, users);
            }

            displayArticles(articles, users) {
                const container = document.getElementById('userArticles');
                const noArticles = document.getElementById('noArticles');

                if (articles.length === 0) {
                    container.style.display = 'none';
                    noArticles.style.display = 'block';
                    return;
                }

                noArticles.style.display = 'none';
                container.innerHTML = articles.map(article => {
                    const author = users.find(u => u.email === article.authorEmail);
                    const avatar = author ? author.avatar : 'üë§';
                    let avatarHTML = avatar;
                    if (avatar && avatar.startsWith('data:')) {
                        avatarHTML = `<img src="${avatar}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">`;
                    } else {
                        avatarHTML = `<span style="font-size: 18px;">${avatar}</span>`;
                    }
                    
                    return `
                        <div class="content-item" style="background: white; border-radius: 6px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); transition: all 0.2s ease;">
                            <div class="content-item__category" style="display: inline-block; font-size: 10px; color: #4a9eff; text-transform: uppercase; margin-bottom: 8px;">${article.category}</div>
                            <div class="content-item__title" style="font-size: 14px; font-weight: 600; color: #222; margin-bottom: 8px;">${article.title}</div>
                            <p style="font-size: 12px; color: #666; margin: 8px 0;">${article.description}</p>
                            <div style="font-size: 11px; color: #999; display: flex; justify-content: space-between; margin-top: 8px;">
                                <span>${article.date}</span>
                                <span style="display: flex; align-items: center; gap: 6px;">${avatarHTML} ${article.author}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            displayPosts(posts, users) {
                const container = document.getElementById('userPosts');
                const noPosts = document.getElementById('noPosts');

                if (posts.length === 0) {
                    container.style.display = 'none';
                    noPosts.style.display = 'block';
                    return;
                }

                noPosts.style.display = 'none';
                container.innerHTML = posts.map(post => {
                    const author = users.find(u => u.email === post.authorEmail);
                    const avatar = author ? author.avatar : 'üë§';
                    let avatarHTML = avatar;
                    if (avatar && avatar.startsWith('data:')) {
                        avatarHTML = `<img src="${avatar}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">`;
                    } else {
                        avatarHTML = `<span style="font-size: 18px;">${avatar}</span>`;
                    }
                    
                    return `
                        <div class="content-item" style="background: white; border-radius: 6px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); transition: all 0.2s ease;">
                            <div class="content-item__category" style="display: inline-block; font-size: 10px; color: #4a9eff; text-transform: uppercase; margin-bottom: 8px;">–§–æ—Ä—É–º</div>
                            <div class="content-item__title" style="font-size: 14px; font-weight: 600; color: #222; margin-bottom: 8px;">${post.title}</div>
                            <p style="font-size: 12px; color: #666; margin: 8px 0;">${post.message}</p>
                            <div style="font-size: 11px; color: #999; display: flex; justify-content: space-between; margin-top: 8px;">
                                <span>${post.date}</span>
                                <span style="display: flex; align-items: center; gap: 6px;">${avatarHTML} ${post.author}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            setupSubscribeButton(user) {
                const currentUser = JSON.parse(localStorage.getItem(this.currentUserKey));
                const subscribeBtn = document.getElementById('subscribeBtn');

                if (!currentUser || currentUser.id === user.id) {
                    subscribeBtn.style.display = 'none';
                    return;
                }

                subscribeBtn.style.display = 'inline-block';

                const isFollowing = authManager ? authManager.isFollowing(user.id) : false;
                if (isFollowing) {
                    subscribeBtn.textContent = '‚úì –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã';
                    subscribeBtn.classList.add('subscribed');
                }

                subscribeBtn.addEventListener('click', () => {
                    if (authManager) {
                        authManager.subscribeToUser(user.id);
                        const isNowFollowing = authManager.isFollowing(user.id);
                        
                        if (isNowFollowing) {
                            subscribeBtn.textContent = '‚úì –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã';
                            subscribeBtn.classList.add('subscribed');
                        } else {
                            subscribeBtn.textContent = 'üìå –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                            subscribeBtn.classList.remove('subscribed');
                        }

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        const users = JSON.parse(localStorage.getItem(this.usersKey)) || [];
                        const updatedUser = users.find(u => u.id === user.id);
                        if (updatedUser) {
                            const subscribersCount = updatedUser.followers ? updatedUser.followers.length : 0;
                            document.getElementById('userSubscribersCount').textContent = subscribersCount;
                        }
                    }
                });
            }

            showNotFound() {
                document.getElementById('userContent').style.display = 'none';
                document.getElementById('userNotFound').style.display = 'block';
            }
        }

        let userProfileViewer;
        document.addEventListener('DOMContentLoaded', () => {
            userProfileViewer = new UserProfileViewer();
        });
    </script>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal__overlay"></div>
        <div class="modal__content" style="max-width: 500px;">
            <div class="modal__header">
                <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <button id="closeAuthBtn" class="modal__close-btn">&times;</button>
            </div>
            
            <div class="auth-tabs">
                <button id="loginTab" class="auth-tab active">üîê –í—Ö–æ–¥</button>
                <button id="registerTab" class="auth-tab">‚úçÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="forum-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                </div>
                
                <button type="button" id="loginSubmit" class="btn btn--primary" style="width: 100%;">–í–æ–π—Ç–∏</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="forum-form" style="display: none;">
                <div class="form-group">
                    <label for="registerName">–ò–º—è</label>
                    <input type="text" id="registerName" placeholder="–í–∞—à–µ –∏–º—è" required>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPasswordConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                
                <button type="button" id="registerSubmit" class="btn btn--primary" style="width: 100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
        </div>
    </div>

    <!-- User Menu (for logged in users) -->
    <div id="userMenu" style="display: none; position: absolute; top: 60px; right: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 999;">
        <a href="profile.html" style="display: block; padding: 12px 20px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
        <button id="logoutBtn" style="width: 100%; padding: 12px 20px; background: none; border: none; color: #ef4444; cursor: pointer; text-align: left; font-weight: 600;">üö™ –í—ã—Ö–æ–¥</button>
    </div>
</body>
</html>
